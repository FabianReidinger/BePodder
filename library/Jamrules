
# The directories used by the build.
BUILD_DIR			= [ FDirName $(TOP) build ] ;
GENERATED_DIR		= [ FDirName $(TOP) generated ] ;
DISTRO_DIR			= [ FDirName $(TOP) generated distro ] ;

include [ FDirName $(BUILD_DIR) HelperRules ] ;
include [ FDirName $(BUILD_DIR) ConfigRules ] ;
include [ FDirName $(BUILD_DIR) OverriddenJamRules ] ;
include [ FDirName $(BUILD_DIR) MainBuildRules ] ;
include [ FDirName $(BUILD_DIR) BuildSettings ] ;

# Include UserBuildConfig.
{
	local userBuildConfig = [ GLOB $(BUILD_DIR) : UserBuildConfig ] ;
	if $(userBuildConfig)
	{
		LOCATE on UserBuildConfig = $(BUILD_DIR) ;
		include UserBuildConfig ;
	}
}

# default to strip generated apps if not specified otherwise:
STRIP_APPS ?= 1 ;

# Cache files for header scanning and jamfile caching.
HCACHEFILE = header_cache ;
JCACHEFILE = jamfile_cache ;
LOCATE on $(HCACHEFILE) $(JCACHEFILE) = $(GENERATED_DIR) ;


rule MakeDistro
{
	# MakeDistro <target> 

	local target = $1 ;

	NotFile $(target) ;
	Always $(target) ;
}

actions MakeDistro
{
	echo "making distro $(DISTRO_DIR)" ;

	jam

	ln -sf ../library/librunview/include ../include/runview
	ln -sf ../library/libclv/include ../include/libclv
	ln -sf ../library/libfish/include ../include/libfish
	ln -sf ../library/libfunky/include ../include/libfunky

	cp $(DISTRO_DIR)/libclv.a ../libs/libclv.a

	if [ $(DEFINES)="ZETA" ] 
	then
		echo "zeta"
		cp $(DISTRO_DIR)/libfish.a ../libs/libfish.a
		cp $(DISTRO_DIR)/librunview.a ../libs/librunview.a
		cp $(DISTRO_DIR)/libfunky.a ../libs/libfunky.a
	else
		echo "beos"
		cp $(DISTRO_DIR)/libfish.a ../libs/libfish.r5.a
		cp $(DISTRO_DIR)/librunview.a ../libs/librunview.r5.a
		cp $(DISTRO_DIR)/libfunky.a ../libs/libfunky.r5.a
	fi
}
